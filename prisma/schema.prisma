// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Hotel/Pousada
model Hotel {
  id          String   @id @default(uuid())
  nome        String
  cnpj        String?  @unique
  endereco    String
  cidade      String
  estado      String
  cep         String?
  telefone    String?
  email       String?
  descricao   String?  @db.Text
  ativo       Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  quartos           Quarto[]
  reservas          Reserva[]
  usuarios          Usuario[]
  configuracao      ConfiguracaoPousada?

  @@map("hoteis")
}

// Tipos de Quartos (Standard, Luxo, Suíte, etc)
model TipoQuarto {
  id              String   @id @default(uuid())
  nome            String
  descricao       String?  @db.Text
  capacidadePessoas Int
  precoBase       Decimal  @db.Decimal(10, 2)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  quartos         Quarto[]

  @@map("tipos_quartos")
}

// Quartos físicos de cada hotel
model Quarto {
  id            String   @id @default(uuid())
  numero        String
  hotelId       String
  tipoQuartoId  String
  andar         Int?
  status        StatusQuarto @default(DISPONIVEL)
  observacoes   String?  @db.Text
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  hotel         Hotel        @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  tipoQuarto    TipoQuarto   @relation(fields: [tipoQuartoId], references: [id])
  reservas      Reserva[]

  @@unique([hotelId, numero])
  @@map("quartos")
}

// Clientes
model Cliente {
  id            String   @id @default(uuid())
  nome          String
  email         String   @unique
  telefone      String
  cpf           String?  @unique
  dataNascimento DateTime?
  endereco      String?
  cidade        String?
  estado        String?
  cep           String?
  observacoes   String?  @db.Text
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  reservas      Reserva[]

  @@map("clientes")
}

// Reservas
model Reserva {
  id              String   @id @default(uuid())
  clienteId       String
  quartoId        String
  hotelId         String
  dataCheckIn     DateTime
  dataCheckOut    DateTime
  numeroPessoas   Int
  valorTotal      Decimal  @db.Decimal(10, 2)
  valorPago       Decimal? @db.Decimal(10, 2) @default(0)
  status          StatusReserva @default(PENDENTE)
  observacoes     String?  @db.Text
  dataConfirmacao DateTime?
  dataPrazoConfirmacao DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  cliente         Cliente  @relation(fields: [clienteId], references: [id])
  quarto          Quarto   @relation(fields: [quartoId], references: [id])
  hotel           Hotel    @relation(fields: [hotelId], references: [id])
  auditoria       AuditoriaReserva[]

  @@map("reservas")
}

// Usuários do sistema (recepcionistas, gerentes)
model Usuario {
  id          String   @id @default(uuid())
  nome        String
  email       String   @unique
  senha       String
  hotelId     String?
  role        RoleUsuario @default(RECEPCIONISTA)
  ativo     Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  hotel     Hotel?   @relation(fields: [hotelId], references: [id])
  tokensVerificacao TokenVerificacao[]

  @@map("usuarios")
}

model TokenVerificacao {
  id         String   @id @default(uuid())
  token      String   @unique
  usuarioId  String
  expiresAt  DateTime
  createdAt  DateTime @default(now())

  usuario    Usuario  @relation(fields: [usuarioId], references: [id], onDelete: Cascade)

  @@map("tokens_verificacao")
}

// Auditoria de Reservas
model AuditoriaReserva {
  id              String   @id @default(uuid())
  reservaId       String
  usuarioId       String?
  statusAnterior  StatusReserva
  statusNovo      StatusReserva
  descricao       String?  @db.Text
  ipAdress        String?
  userAgent       String?
  createdAt       DateTime @default(now())

  reserva         Reserva  @relation(fields: [reservaId], references: [id], onDelete: Cascade)

  @@map("auditoria_reservas")
}

// Configurações da Pousada
model ConfiguracaoPousada {
  id                          String   @id @default(uuid())
  hotelId                     String   @unique
  horaCheckIn                 String   @default("14:00")
  horaCheckOut                String   @default("12:00")
  regras                      String?  @db.Text
  prazoDiasConfirmacaoReserva Int      @default(3)
  
  // Templates de mensagens WhatsApp
  templateConfirmacao         String?  @db.Text
  templateCancelamento        String?  @db.Text
  templateLembrete            String?  @db.Text
  
  createdAt                   DateTime @default(now())
  updatedAt                   DateTime @updatedAt

  hotel                       Hotel    @relation(fields: [hotelId], references: [id], onDelete: Cascade)

  @@map("configuracoes_pousadas")
}

// Enums
enum StatusQuarto {
  DISPONIVEL
  OCUPADO
  MANUTENCAO
  INATIVO
}

enum StatusReserva {
  PENDENTE
  CONFIRMADA
  CANCELADA
  NO_SHOW
  FINALIZADA
}

enum RoleUsuario {
  ADMIN
  GERENTE
  RECEPCIONISTA
}
